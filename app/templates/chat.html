{% extends "base.html" %}

{% block title %}Generate Puzzle{% endblock %}

{% block content %}

<div class="chat-layout">

    <!-- Left Sidebar: Header and Sessions List -->
    <div class="sidebar-wrapper">
        <!-- Sidebar Header with Menu -->
        <div class="sidebar-header">
            <!-- Burger Menu -->
            <div class="burger-menu">
                <button class="burger-btn" id="burger-btn">☰</button>
                <div class="burger-dropdown" id="burger-dropdown">
                    <a href="/">Home</a>
                    <a href="/puzzles">Puzzles</a>
                    <a href="/puzzles/create-puzzle">Create Puzzle</a>
                    <a href="/puzzles/generate">Generate Puzzle</a>
                </div>
            </div>
            <!-- Menu -->
                <a href="/puzzles/chat" class="sidebar-btn">
                <img src="/static/new_session.svg" class="session-new-icon" alt="New session">
                New Session</a>
        </div>

        <!-- Sessions List -->
        <div class="sessions-sidebar">
            <h3>Sessions</h3>
            <div id="sessions-list-container"
                 class="sessions-list"
                 hx-get="/puzzles/chat/sidebar"
                 hx-trigger="refreshSidebar from:body"
                 hx-swap="innerHTML"
                 hx-include="#session_id_input">
                {% include "partials/chat_sidebar_items.html" %}
            </div>
        </div>
    </div>


    <!-- Chat Container -->
    <div class="chat-main" id="chat-main">
        <div id="chat-container">
            <div class="ai_response">Hello! How can I help you?</div>
        </div>
         <div id="thinking-indicator" class="ai_response htmx-indicator">
            <img src="../static/llm_loading.gif" height="20" width="60"></div>

        <form id="chat-form"
              data-target="#chat-container"
              style="cursor: pointer;">

            <input type="hidden" name="session_id" id="session_id_input"
                   value="{{ latest_session_id|string if latest_session_id else '' }}">

            <div class="text_input_area">
            <textarea type="text" id="user-input" name="content" placeholder="Type your message..." required
                      style="width: 100%; height: 50px; margin: auto; text-align: left"></textarea>

                <div class="input-actions">
                    <select id="model" name="model" required>
                        <option value="gpt-4o-mini">GPT 4o mini</option>
                        <option value="gpt-4.1-mini">GPT 4.1 mini</option>
<!--                        <option value="gemini-3-pro">Gemini 3 Pro</option>-->
<!--                        <option value="gemini-3-flash">Gemini 3 Flash</option>-->
                        <option value="gemini-2.5-pro">Gemini 2.5 Pro</option>
                        <option value="gemini-2.5-flash">Gemini 2.5 Flash</option>
                        <option value="gemini-2.5-flash-lite">Gemini 2.5 Flash-Lite</option>
<!--                        <option value="gemini-2.0-flash">Gemini 2 Flash</option>-->
<!--                        <option value="gemini-2.0-flash-lite">Gemini 2 Flash-Lite</option>-->
<!--                        <option value="gemini-2.0-flash-exp">Gemini 2.0 Flash-exp</option>-->
<!--                        <option value="gemini-1.5-pro">Gemini 1.5 Pro</option>-->
<!--                        <option value="gemini-1.5-flash">Gemini 1.5 Flash</option>-->
                    </select>
                    <button type="submit" id="sendBtn">▶</button>
                </div>
            </div>
        </form>
    </div>


    <!-- Resizer Divider -->
    <div class="resizer" id="drag-resizer"></div>

    <!-- Puzzle Editor -->
    <div class="puzzle-visualization" id="puzzle-visualization">
        <div id="editor-integration-container"
             hx-get="/puzzles/chat/editor"
             hx-trigger="load, refreshPuzzle from:body"
             hx-target="this"
             hx-swap="innerHTML"
             hx-include="#session_id_input">
        </div>
    </div>
    <script src="/static/editor.js" defer></script>

</div>


{% endblock %}

<!--
 <div id="thinking-indicator" class="ai_response htmx-indicator">
            <img src="../static/llm_loading.gif" height="20" width="60">

<button id="send-button" type="submit" class="btn">
                        <span class="default-icon">▶</span>
                        <span class="loading-icon">■</span></button>