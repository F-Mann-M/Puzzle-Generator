{% extends "base.html" %}

{% block title %}Generate Puzzle{% endblock %}

{% block content %}

<h2>Puzzle Council</h2>

<div class="chat-layout">
    <!-- Left Sidebar: Sessions List -->
    <div class="sessions-sidebar">
        <h3>Sessions</h3>
        <div class="sessions-list">
            {% if all_sessions %}
            {% for session in all_sessions %}
            <div class="session-item {% if latest_session_id == session.id %}active{% endif %}"
                 hx-get="/puzzles/chat/{{ session.id }}"
                 hx-target="#chat-container"
                 hx-swap="innerHTML"
                 hx-on::after-request="document.querySelector('input[name=session_id]').value = '{{ session.id }}'"
                 style="cursor: pointer;">
                <div class="session-topic">{{ session.topic_name }}</div>
                <div class="session-date">{{ session.created_at.strftime('%Y-%m-%d %H:%M') if session.created_at else ''
                    }}
                </div>
                <button hx-delete="{{session.id}}/delete"
                        hx-trigger="click"
                        hx-target="closest tr"
                        hx-swap="outerHTML">
                    Delete
                </button>
            </div>
            {% endfor %}
            {% else %}
            <p>No sessions yet</p>
            {% endif %}
        </div>
    </div>

    <!-- Chat Container -->
    <div class="chat-main">
        <div id="chat-container">
            Welcome to the council. I'm Rudolfo. I will help you devise the best puzzles.
            <!--            {% if session_content %}-->
            <!--            {% for message in session_content %}-->
            <!--            <p> {% if message.role == "User" %}<span class="user_message"><strong>You:</strong> {{message.content}}</span><br>-->
            <!--                {% else %}<span class="ai_response"><strong>Rudolfo:</strong> {{message.content}}</span></p>-->
            <!--            {% endif %}-->
            <!--            {% endfor %}-->
            <!--            {% endif %}-->
        </div>
        <form id="chat-form"
              hx-post="chat"
              hx-target="#chat-container"
              hx-swap="beforeend"
              hx-ext="json-enc"
              hx-reset="true"
              hx-on::after-request="document.getElementById('user-input').value = ''">

            <!--send hidden session id-->
            <input type="hidden" name="session_id" id="session_id_input" value="">

            <br><br>
            <textarea type="text" id="user-input" name="content" placeholder="Type your message..." required
                      style="width: 80%; height: 150px; margin: auto; text-align: left"></textarea><br><br>

            <!-- choose Model -->
            <label for="model">Model:</label>
            <select id="model" name="model" required>
                <option value="gpt-4o-mini">GPT 4o mini</option>
                <option value="gpt-4.1-mini">GPT 4.1 mini</option>
                <option value="gemini-3-pro-preview">Gemini 3 pro preview</option>
                <option value="gemini-2.5-flash">Gemini 2.5 Flash</option>
                <option value="gemini-2.5-flash-lite">Gemini 2.5 Flash-Lite</option>
                <option value="gemini-2.0-flash">Gemini 2 Flash</option>
                <option value="gemini-2.0-flash-lite">Gemini 2 Flash-Lite</option>
            </select>
            <button type="submit" id="sendBtn">Send</button>
        </form>
    </div>
</div>

{% endblock %}